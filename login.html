<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#e8f5e9;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
  .box{background:white;padding:20px;border-radius:12px;width:320px;box-shadow:0 6px 24px rgba(0,0,0,0.12)}
  h2{color:#2c7a3f;margin:0 0 12px}
  input{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #cfe8d5}
  button{width:100%;padding:10px;background:#2e8d47;color:#fff;border:none;border-radius:8px;font-weight:bold;cursor:pointer}
  .link{margin-top:10px;text-align:center}
  .link a{color:#2e8d47;text-decoration:none;font-weight:bold}
</style>
</head>
<body>
  <div class="box">
    <h2>Login</h2>
    <input id="username" placeholder="Username" />
    <input id="password" type="password" placeholder="Password" />
    <button id="btnLogin">Login</button>
    <div class="link">Don't have an account? <a href="signup.html">Sign up</a></div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyA3q1drfYYuq0MGztqr8T6Cq42RGKmiVno",
  authDomain: "budgetcalculator-22ef5.firebaseapp.com",
  projectId: "budgetcalculator-22ef5",
  storageBucket: "budgetcalculator-22ef5.firebasestorage.app",
  messagingSenderId: "574952478496",
  appId: "1:574952478496:web:0ac32ab61ec6b130db2945",
  databaseURL: "https://budgetcalculator-22ef5-default-rtdb.asia-southeast1.firebasedatabase.app/"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

async function hash(text){
  const buffer = new TextEncoder().encode(text);
  const dig = await crypto.subtle.digest("SHA-256", buffer);
  return Array.from(new Uint8Array(dig)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

document.getElementById("btnLogin").addEventListener("click", async ()=>{
  const user = document.getElementById("username").value.trim();
  const pass = document.getElementById("password").value;
  if(!user || !pass){ alert("Fill both fields"); return; }
  try{
    const snap = await get(ref(db, `users/${user}`));
    if(!snap.exists()){ alert("No such user"); return; }
    const obj = snap.val();
    const hashed = await hash(pass);
    if(obj.password === hashed){
      localStorage.setItem("loggedInUser", user);
      window.location.href = "Home.html";
    } else {
      alert("Wrong password");
    }
  }catch(e){
    console.error(e); alert("Login failed (see console)");
  }
});
</script>
</body>
</html>

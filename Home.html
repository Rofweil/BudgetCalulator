<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Home</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #e8f5e9;
        text-align: center;
        padding: 20px;
    }
    .box {
        background: white;
        padding: 20px;
        border-radius: 14px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.12);
        width: 350px;
        margin: auto;
    }
    .btn {
        display: block;
        background: #2e8d47;
        color: white;
        padding: 12px;
        border-radius: 8px;
        text-decoration: none;
        margin: 10px 0;
        font-size: 16px;
        cursor: pointer;
    }
    .btn:hover {
        opacity: 0.85;
    }
    #logout {
        background: #b33a3a;
    }
</style>
</head>
<body>

<h2>Welcome</h2>

<div class="box">
    <p><b>Salary:</b> RM <span id="salary">0</span></p>
    <p><b>Total Commitments:</b> RM <span id="totalCommitment">0</span></p>

    <button class="btn" onclick="goInput()">Input Data</button>
    <button class="btn" onclick="goCommit()">Commitment</button>
    <button class="btn" onclick="goDates()">Home Date Range</button>

    <button id="logout" class="btn" onclick="logout()">Logout</button>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
    databaseURL: "https://money-record-ef819-default-rtdb.asia-southeast1.firebasedatabase.app/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);


// ----------------------
//  LOGIN CHECK
// ----------------------
const user = localStorage.getItem("loggedInUser");

if (!user) {
    alert("You must login first!");
    window.location.href = "login.html";
}


// ----------------------
//  LOAD USER DATA
// ----------------------
async function loadData() {
    const userRef = ref(db, "users/" + user);
    const snap = await get(userRef);

    if (!snap.exists()) {
        alert("User not found in database!");
        return;
    }

    const data = snap.val();

    const salary = data.salary || 0;
    const commitments = data.commitments || {};

    document.getElementById("salary").textContent = salary;

    // Calculate total
    let total = 0;
    for (let key in commitments) {
        const val = parseFloat(commitments[key]);
        if (!isNaN(val)) total += val;
    }

    document.getElementById("totalCommitment").textContent = total.toFixed(2);
}

loadData();


// ----------------------
//  NAVIGATION BUTTONS
// ----------------------
window.goInput = function () {
    window.location.href = "SalaryInput.html";
};

window.goCommit = function () {
    window.location.href = "Commitment.html";
};

window.goDates = function () {
    window.location.href = "HomeDates.html";
};


// ----------------------
//  LOGOUT
// ----------------------
window.logout = function () {
    localStorage.removeItem("loggedInUser");
    alert("Logged out!");
    window.location.href = "login.html";
};

</script>

</body>
</html>
